// Australia - AU
//    Western Australia - WA
//    Tasmania - TAS
//    Jervis Bay Territory - JBT
//    Victoria - VIC
//    Northern Territory - NT
//    Queensland - QLD
//    South Australia - SA
//    New South Wales - NSW 

//Austria - AT
//    Vorarlberg - Vorarlberg
//    Wien - Wien
//    Oberösterreich - Oberösterreich
//    Salzburg - Salzburg
//    Steiermark - Steiermark
//    Tirol - Tirol
//    Burgenland - Burgenland
//    Kärnten - Kärnten
//    Niederösterreich - Niederösterreich

// Belgium - BE
//    West Flanders - WV
//    Antwerp - Antwerp
//    Luxembourg - LX
//    Walloon Brabant - BW
//    Flemish Brabant - VB
//    East Flanders -  OV
//    Liege - Liege
//    Limburg - LI
//    Hainaut - HT
//    Namur - Namur
//    Brussels - Brussels

//Canada - CA
//    Northwest Territories - NT
//    Nunavut - NU
//    Nova Scotia - NS
//    British Columbia - BC
//    Saskatchewan - SK
//    Quebec - QC
//    Prince Edward Island - PE
//    Manitoba - MB
//    Yukon - YT
//    New Brunswick - NB
//    Newfoundland and Labrador - NL
//    Ontario - ON
//    Alberta - AB

// Columbia - Columbia
//    Valle del Cauca - Valle del Cauca
//    Bolívar - Bolívar
//    Cesar - Cesar 
//    Huila - Huila
//    Vaupés - Vaupés
//    Norte de Santander - Norte de Santander
//    Risaralda - Risaralda
//    Vichada - Vichada
//    Bogota - Bogota
//    Chocó - Chocó
//    Guaviare - Guaviare
//    Casanare - Casanare
//    Caquetá - Caquetá
//    Caldas - Caldas
//    Cauca - Cauca
//    Santander - Santander
//    Atlántico - Atlántico
//    Amazonas - Amazonas
//    Meta - Meta
//    Magdalena - Magdalena
//    Arauca - Arauca
//    Guainía - Guainía
//    San Andrés y Providencia - San Andrés y Providencia
//    Boyacá - Boyacá
//    Quindío - Quindío
//    La Guajira - La Guajira
//    Tolima - Tolima
//    Sucre - Sucre
//    Putumayo - Putumayo
//    Nariño - Nariño
//    Córdoba - Córdoba
//    Cundinamarca - Cundinamarca
//    Antioquia - Antioquia

//France - FR
//    Auvergne - Auvergne
//    Aquitaine - Aquitaine
//    Alsace - Alsace
//    Champagne-Ardenne - Champagne-Ardenne
//    Centre - Centre
//    Bretagne - Bretagne
//    Bourgogne - Bourgogne
//    Languedoc-Roussillon - Languedoc-Roussillon
//    Île-de-France - Île-de-France
//    Franche-Comté - Franche-Comté
//    Nord-Pas-de-Calais - Nord-Pas-de-Calais
//    Midi-Pyrénées - Midi-Pyrénées
//    Limousin - Limousin
//    Picardie - Picardie
//    Pays de la Loire 
//    Haute-Normandie - Haute-Normandie
//    Basse-Normandie - Basse-Normandie
//    Rhône-Alpes - Rhône-Alpes
//    Provence-Alpes-Côte-d'Azur - Provence-Alpes-Côte-d'Azur
//    Poitou-Charentes - Poitou-Charentes
//    Réunion - Réunion
//    Corse - Corse
//    Martinique - Martinique
//    Guadeloupe - Guadeloupe

//GERMANY - DE
//    Berlin - Berlin
//    Sachsen-Anhalt - SA
//    Rheinland-Pfalz - RP
//    Brandenburg - BB
//    Niedersachsen - NDS
//    Mecklenburg-Vorpommern - MV
//    Thüringen - TH
//    Baden-Württemberg - BW
//    Hamburg - Hamburg
//    Schleswig-Holstein - SH
//    Sachsen - SN
//    Nordrhein-Westfalen - NRW
//    Bremen - Bremen
//    Saarland - SL
//    Bayern - BY
//    Hessen - HE

//GreatBritain - GB
//    East Midlands - East Midlands
//    Wales - Wales
//    Northern Ireland - Northern Ireland
//    South East - South East
//    South West - South West
//    London - London
//    East - East
//    West Midlands - West Midlands
//    Scotalnd - Scotalnd
//    Yorkshire and the Humber - Yorkshire and the Humber

// India - IN
//    Bihar - BR
//    Puducherry - Puducherry
//    Daman and Diu - DD
//    Dadra and Nagar Haveli - DN
//    Delhi - DL
//    Nagaland - NL
//    West Bengal - WB
//    Haryana - HR
//    Himachal Pradesh - HP
//    Assam - AS
//    Uttaranchal - UK
//    Jharkhand - JH
//    Jammu and Kashmir - JAM
//    Uttar Pradesh - UP
//    Mizoram - MZ
//    Chhattisgarh - CT
//    Chandigarh - Chandigarh
//    Goa - GA
//    Gujarat - GJ
//    Rajasthan - RJ
//    Madhya Pradesh - MP
//    Orissa - OD
//    Tamil Nadu - TN
//    Andaman and Nicobar - AN
//    Andhra Pradesh - AP
//    Tripura - TR
//    Arunachal Pradesh - AR
//    Karnataka - KA
//    Punjab - PB
//    Meghalaya - ML
//    Manipur - MN
//    Maharashtra - MH
//    Kerala - KL

//Italy - IT
//    Valle d'Aosta - AO
//    Piemonte - Piemonte
//    Lombardia - Lombardia
//    Toscana - Toscana
//    Friuli-Venezia Giulia - Friuli-Venezia Giulia
//    Liguria - Liguria
//    Emilia-Romagna - Emilia-Romagna
//    Marche - Marche
//    Umbria - Umbria
//    Molise - Molise
//    Veneto - Veneto
//    Abruzzo - Abruzzo
//    Lazio - Lazio
//    Apulia - Apulia
//    Basilicata - Basilicata
//    Calabria - Calabria
//    Sicily - Sicily
//    Campania - Campania

//Netherlands - NL
//    Overijssel - Overijssel
//    Friesland - FR
//    Utrecht - Utrecht
//    Gelderland - GE
//    Flevoland - FL
//    Noord-Holland - NH
//    Zeeland - ZE
//    Zuid-Holland - ZH
//    Groningen - Groningen
//    Drenthe - DR
//    Noord-Brabant - NB
//    Limburg - LI

//Poland - PL
//    Greater Poland - Greater Poland
//    Świętokrzyskie - Świętokrzyskie
//    West Pomeranian - West Pomeranian
//    Subcarpathian - Subcarpathian
//    Masovian - Masovian
//    Łódź - Łódź
//    Kuyavian-Pomeranian - Kuyavian-Pomeranian
//    Lublin - Lublin
//    Opole - Opole
//    Pomeranian - Pomeranian
//    Lower Silesian - Lower Silesian
//    Lesser Poland - Lesser Poland
//    Warmian-Masurian - Warmian-Masurian
//    Wroclaw - Wroclaw

//Spain - ES
//    Navarra - Navarra
//    Barcelona - Barcelona
//    Castellón - Castellón
//    Zamora -Zamora
//    Asturias - Asturias
//    Orense - Orense
//    Madrid - Madrid
//    Lérida - Lérida
//    Jaén - Jaén
//    Huelva - Huelva
//    Cuenca - Cuenca
//    Tarragona - Tarragona
//    La Coruña- La Coruña
//    Ávila - Ávila
//    Alicante - Alicante
//    Ciudad Real - Ciudad Real
//    Córdoba - Córdoba
//    Valladolid - Valladolid
//    Santa Cruz de Tenerife - Santa Cruz de Tenerife
//    Zaragoza - Zaragoza
//    Málaga - Málaga
//    Almería - Almería
//    Ceuta - Ceuta
//    Baleares - Baleares
//    Álava - Álava
//    Cantabria - Cantabria
//    Teruel - Teruel
//    Сáceres - Сáceres
//    Palencia - Palencia
//    Pontevedra - Pontevedra
//    Las Palmas - Las Palmas
//    Gerona - Gerona
//    Toledo - Toledo
//    Murcia - Murcia
//    Granada - Granada
//    Guadalajara - Guadalajara
//    Albacete - Albacete
//    Soria - Soria
//    Melilla - Melilla
//    Lugo - Lugo
//    Sevilla - Sevilla
//    Cádiz - Cádiz
//    Segovia - Segovia
//    Burgos - Burgos
//    Salamanca - Salamanca
//    Valencia - Valencia
//    León - León
//    Bizkaia - Bizkaia
//    Huesca - Huesca
//    La Rioja - La Rioja
//    Gipuzkoa - Gipuzkoa
//    Badajoz - Badajoz
//    Bilbao - Bilbao

//USA - US
//    Virginia - VA
//    Pennsylvania - PA
//    Tennessee - TN
//    West Virginia - WV
//    Nevada - NV
//    Texas - TX
//    New Hampshire - NH
//    New York - NY
//    Hawaii - HI
//    Vermont - VT
//    New Mexico -NM
//    North Carolina -NC
//    North Dakota -ND
//    Nebraska - NE
//    Louisiana - LA
//    South Dakota - SD
//    District of Columbia - DC
//    Delaware - DE
//    Florida - FL
//    Connecticut - CT
//    Washington - WA
//    Kansas - KS
//    Wisconsin - WI
//    Oregon - OR
//    Kentucky - KY
//    Ohio - OH
//    Oklahoma - OK
//    Idaho - ID
//    Wyoming - WY
//    Utah - UT
//    Indiana - IN
//    Illinois - IL 
//    Alaska - AK
//    New Jersey - NJ
//    Colorado - CO
//    Maryland - MD
//    Massachusetts - MA
//    Alabama - AL
//    Missouri - MO
//    Minnesota - MN
//    California - CA
//    Iowa - IA
//    Michigan - MI
//    Georgia - GA
//    Arizona - AZ
//    Montana - MT
//    Mississippi - MS
//    South Carolina - SC
//    Rhode Island - RI
//    Arkansas - AR

//ChannelIslands - ChannelIslands
//    Jersey - Jersey
//    Guernsey - Guernsey
//    Alderney - Alderney
//    Sark - Sark
//    Herm - Herm
//    Jethou - Jethou
//    Brecqhou - Brecqhou

// Chile - CL
//    Arica - Arica
//    Parinacota - Parinacota
//    Iquique - Iquique
//    Tamarugal - Tamarugal
//    Antofagasta - Antofagasta
//    El Loa - El Loa
//    Tocopilla - Tocopilla
//    Copiapó - Copiapó
//    Huasco - Huasco
//    Chañaral - Chañaral
//    Elqui - Elqui
//    Limarí - Limarí
//    Choapa - Choapa
//    Isla de Pascua - Isla de Pascua
//    Los Andes - Los Andes
//    Marga Marga - Marga Marga
//    Petorca - Petorca
//    Quillota - Quillota
//    San Antonio - San Antonio
//    San Felipe de Aconcagua - San Felipe de Aconcagua
//    Cachapoal - Cachapoal
//    Colchagua - Colchagua
//    Cardenal Caro - Cardenal Caro
//    Talca - Talca
//    Linares - Linares
//    Curicó - Curicó
//    Concepción - Concepción
//    Ñuble - Ñuble
//    Biobío - Biobío
//    Arauco - Arauco
//    Cautin - Cautin
//    Malleco - Malleco
//    Valdivia - Valdivia
//    Ranco - Ranco
//    Osorno - Osorno
//    Chiloe - Chiloe
//    Palena - Palena
//    Coihaique - Coihaique
//    Aysén - Aysén
//    Capitan Prat - Capitan Prat
//    Magallanes - Magallanes
//    Ultima Esperanza - Ultima Esperanza
//    Tierra del Fuego - Tierra del Fuego
//    Santiago - Santiago
//    Cordillera - Cordillera
//    Maipo - Maipo
//    Talagante - Talagante
//    Melipilla - Melipilla
//    Chacabuco - Chacabuco

//Costa Rica - CR
//    Alajuela - Alajuela
//    Cartago - Cartago
//    Liberia - Liberia
//    Heredia - Heredia
//    Puerto Limón - Puerto Limón
//    Puntarenas - Puntarenas
//    San José - San José

//Egypt - RG
//    Alexandria - Alexandria
//    Aswan - Aswan
//    Asyut - Asyut
//    Beheira - Beheira
//    Beni Suef - Beni Suef
//    Cairo - Cairo
//    Dakahlia - Dakahlia
//    Damietta - Damietta
//    Faiyum - Faiyum
//    Gharbia - Gharbia
//    Giza - Giza
//    Ismailia - Ismailia
//    Kafr El Sheikh - Kafr El Sheikh
//    Luxor - Luxor
//    Matruh - Matruh
//    Minya - Minya
//    Monufia - Monufia
//    New Valley - New Valley
//    North Sinai - North Sinai
//    Port Said - Port Said
//    Qalyubia - Qalyubia
//    Qena - Qena
//    Red Sea - Red Sea
//    Sharqia - Sharqia 
//    Sohag - Sohag
//    South Sinai - South Sinai
//    Suez - Suez

//ElSalvador - SV
//   Ahuachapán - Ahuachapán
//   Cabañas - Cabañas
//   Chalatenango - Chalatenango
//   Cuscatlán - Cuscatlán
//   La Libertad - La Libertad
//   La Paz - La Paz
//   La Unión - La Unión
//   Morazán - Morazán
//   San Miguel - San Miguel
//   San Salvador - San Salvador
//   San Vicente - San Vicente
//   Santa Ana - Santa Ana
//   Sonsonate - Sonsonate
//   Usulután - Usulután

//Guatemala - GT
//   Alta Verapaz - Alta Verapaz
//   Baja Verapaz - Baja Verapaz
//   Chimaltenango - Chimaltenango
//   Chiquimula - Chiquimula
//   El Progreso - El Progreso
//   Escuintla - Escuintla
//   Guatemala - Guatemala
//   Huehuetenango - Huehuetenango
//   Izabal - Izabal
//   Jalapa - Jalapa
//   Jutiapa - Jutiapa
//   Petén - Petén 
//   Quetzaltenango - Quetzaltenango
//   Quiché - Quiché
//   Retalhuleu - Retalhuleu
//   Sacatepéquez - Sacatepéquez
//   San Marcos - San Marcos
//   Santa Rosa - Santa Rosa
//   Sololá - Sololá
//   Suchitepéquez - Suchitepéquez
//   Totonicapán - Totonicapán
//   Zacapa - Zacapa

//Ireland - Ireland
//   Leinster - Leinster
//   Ulster - Ulster
//   Munster - Munster
//   Connacht - Connacht

// Malaysia - MY
//   Johor Darul Ta'zim - Johor Darul Ta'zim
//   Kedah Darul Aman - Kedah Darul Aman
//   Kelantan Darul Naim - Kelantan Darul Naim
//   Melaka - Melaka
//   Negeri Sembilan Darul Khusus - Negeri Sembilan Darul Khusus
//   Pahang Darul Makmur - Pahang Darul Makmur
//   Penang - Penang
//   Perak Darul Ridzuan - Perak Darul Ridzuan
//   Perlis Indera Kayangan - Perlis Indera Kayangan
//   Sabah - Sabah
//   Sarawak - Sarawak
//   Selangor Darul Ehsan - Selangor Darul Ehsan
//   Terengganu Darul Iman - Terengganu Darul Iman

//Panama - PA
//   Bocas del Toro - Bocas del Toro
//   Chiriquí - Chiriquí
//   Coclé - Coclé
//   Colón - Colón
//   Darién - Darién
//   Herrera - Herrera
//   Los Santos - Los Santos
//   Panamá - Panamá
//   Panamá Oeste - Panamá Oeste
//   Veraguas - Veraguas

//Qatar - QA
//    Al Shamal - Al Shamal
//    Al Khor - Al Khor
//    Umm Salal - Umm Salal
//    Al Daayen - Al Daayen
//    Al Rayyan - Al Rayyan
//    Ad Dawhah - Ad Dawhah
//    Al Wakrah - Al Wakrah
//    Al-Shahaniya - Al-Shahaniya

//Saudi Arabia - SA
//    Qassim - Qassim
//    Riyadh - Riyadh
//    Tabuk - Tabuk
//    Madinah - Madinah
//    Makkah - Makkah
//    Northern Borders - Northern Borders
//    Jawf - Jawf
//    Ha'il - Ha'il
//    Bahah - Bahah
//    Jizan - Jizan
//    Asir - Asir
//    Najran - Najran
//    Eastern Province - Eastern Province

jQuery(function($){

    //==================================================
    //================= VARIABLES
    //==================================================
    var map,
        mapZoom = 4,
        mapCenter = new google.maps.LatLng(55.203129, -94.929710),
        mapStyles = [{"featureType":"all","elementType":"geometry.fill","stylers":[{"weight":"2.00"}]},{"featureType":"all","elementType":"geometry.stroke","stylers":[{"color":"#9c9c9c"}]},{"featureType":"all","elementType":"labels.text","stylers":[{"visibility":"on"}]},{"featureType":"landscape","elementType":"all","stylers":[{"color":"#f2f2f2"}]},{"featureType":"landscape","elementType":"geometry.fill","stylers":[{"color":"#ffffff"}]},{"featureType":"landscape.man_made","elementType":"geometry.fill","stylers":[{"color":"#ffffff"}]},{"featureType":"poi","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"road","elementType":"all","stylers":[{"saturation":-100},{"lightness":45}]},{"featureType":"road","elementType":"geometry.fill","stylers":[{"color":"#eeeeee"}]},{"featureType":"road","elementType":"labels.text.fill","stylers":[{"color":"#7b7b7b"}]},{"featureType":"road","elementType":"labels.text.stroke","stylers":[{"color":"#ffffff"}]},{"featureType":"road.highway","elementType":"all","stylers":[{"visibility":"simplified"}]},{"featureType":"road.arterial","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"transit","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"water","elementType":"all","stylers":[{"color":"#46bcec"},{"visibility":"on"}]},{"featureType":"water","elementType":"geometry.fill","stylers":[{"color":"#c8d7d4"}]},{"featureType":"water","elementType":"labels.text.fill","stylers":[{"color":"#070707"}]},{"featureType":"water","elementType":"labels.text.stroke","stylers":[{"color":"#ffffff"}]}],
        locations,
        markers = [],
        markersClusters,
        image = 'img/marker.png',
        infoWindow,
        textEntries,
        defaultBounds = null,
        autocompleteLocation,
        geocoder = new google.maps.Geocoder(),
        input = document.getElementById('searchTextField'),
        circle,
        checkSelectItems = 0,
        mapProvince = 0,
        mapCompanyBrand = 0,
        mapCountry = 0,
        mapProductAndServices = 0,
        clusterStyles = [
            {
                url: 'img/cluster.png',
                height: 70,
                width: 14,
                textColor: '#000',
                textSize: 14
            }
        ];

    var provinces = [],
        provincesOptions = $('.setMapLocation.province option'),
        provincesLen = provincesOptions.length;
    for(let i=0; i<provincesLen; i++){
        provinces.push({"value":$(provincesOptions[i]).attr('value'), "text":$(provincesOptions[i]).text()});
    }

    var radiuses = [],
        radiusesOptions = $('#setradius option'),
        radiusesLen = radiusesOptions.length;
    for(let i=0; i<radiusesLen; i++){
        radiuses.push({"value":$(radiusesOptions[i]).attr('value'), "text":$(radiusesOptions[i]).text()});
    }
    
    //==================================================
    //================= INIT
    //==================================================
	var mapInit = function() {

        var autoCompleteOptions = {
            types: ['(regions)'],
            // types: ['(cities)'],
        };
        
        autocomplete = new google.maps.places.Autocomplete(input, autoCompleteOptions);

        google.maps.event.addListener(autocomplete, 'place_changed', function() {
            var place = autocomplete.getPlace();
            if(place) {
                locationAutocomplete(place);
            }
            else mapPopup('Autocomplete error');
        });

        var options = {
            'zoom': mapZoom,
            'center': mapCenter,
            'mapTypeId': google.maps.MapTypeId.ROADMAP,
            styles: mapStyles,
            streetViewControl: false,
            zoomControlOptions: {
                position: google.maps.ControlPosition.RIGHT_BOTTOM
            }
        };
        map = new google.maps.Map(document.getElementById('map-locations'), options);

        $.ajax({
            url: 'map-location.json',
            type: 'get',
            dataType: 'json',
            error: function(data){
                mapPopup("Error receiving external data file");
            },
            success: function(data){

                locations = data.locations;

                if (locations.length > 0) {

                    $('.locationCounter span').html(locations.length);

                    showMarkers(null);

                    var markersLen = markers.length;
                    if(markersLen){
                        var bounds = new google.maps.LatLngBounds();
                        for (var j=0; j<markersLen; j++) {
                            bounds.extend(markers[j].getPosition());
                        }
                        defaultBounds = bounds;
                        map.fitBounds(defaultBounds);

                    // -- Set new map zoom after Init
                    zoomChangeBoundsListener = google.maps.event.addListener(map, 'bounds_changed', function(event) {
                        this.setZoom(2);
                    
                        google.maps.event.removeListener(zoomChangeBoundsListener);
                
                    });
                    // ---
                    }

                    if (window.navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(function (position) {
                            var location = {lat: position.coords.latitude, lng: position.coords.longitude};
                            geocoder.geocode({'latLng': location}, function(results, status) {
                                if (status == google.maps.GeocoderStatus.OK && results[0]) {
                                    locationAutocomplete(results[0]);
                                    $(input).val(results[0].formatted_address);
                                }
                            });
                        });
                    }

                    infoWindow = new SnazzyInfoWindow({
                        map: map,
                        position: mapCenter,
                        closeOnMapClick: false,
                        offset: {
                            top: '-30px',
                            left: '0px'
                        }
                    });
                    
                    map.addListener('idle', function() {
                        showTextEntries(map.getBounds());
                    });

                } else {
                    mapPopup("No locations received");
                }
            }
        });

	};

    mapInit();

    //==================================================
    //================= MARKERS
    //==================================================

    //show array
    var showMarkers = function(bounds, ifReturnLength) {
        clearLocations();


        var len = locations.length,
            index = 0;
    
        for (let i = 0; i < len; i++) {
            var latLng = new google.maps.LatLng(locations[i].provinceLocation.provinceLat, locations[i].provinceLocation.provinceLng); 
            if (bounds && !bounds.contains(latLng)) continue;
            showSingleMarker(latLng, locations[i].phone, locations[i].hrefPhone, locations[i].locationPage, locations[i].name, locations[i].pupUpinfoWindow, locations[i].companyAddress, index);
            index++;
        }

        markersClusters = new MarkerClusterer(map, markers, {styles: clusterStyles});
        google.maps.event.addListener(markersClusters, 'clusterclick', function(){
            scrollToMap();
        });

        if(arguments.length == 2 && ifReturnLength) return markers.length;
        else if(markers.length===0) mapPopup('No locations');
    };


    var showProvinceMarkers = function(setMapLocationValue) {
        clearLocations();

        var len = locations.length,
            index = 0, 
            lastLocationItem = 1,
            latLng;

        if (mapCountry) { // json country
            len = locations.length;

            for (let i = 0; i < len; i++) {

                if(lastLocationItem >= len) {
                    index_map = 0;
                }
                lastLocationItem++;

                latLng = new google.maps.LatLng(locations[i].provinceLocation.provinceLat, locations[i].provinceLocation.provinceLng);
                
                if (locations[i].short_name != setMapLocationValue) continue;

                showSingleMarker(latLng, locations[i].phone, locations[i].hrefPhone, locations[i].locationPage, locations[i].name, locations[i].pupUpinfoWindow, locations[i].companyAddress, index);
                
                if (  $('.setMapLocation.province').find('option').eq(checkSelectItems).val() == locations[i].provinceShortName) {
                } else {
                    addProvince(locations[i].provinceName, locations[i].provinceShortName, locations[i].prouductAndServices, locations[i].companyBrand);
                }

                index++;
            }
        }

        if (mapProvince) { // json province
            for (let i = 0; i < len; i++) {

                latLng = new google.maps.LatLng(locations[i].provinceLocation.provinceLat, locations[i].provinceLocation.provinceLng);

                if (locations[i].provinceShortName != setMapLocationValue) continue;

                showSingleMarker(latLng, locations[i].phone, locations[i].hrefPhone, locations[i].locationPage, locations[i].name, locations[i].pupUpinfoWindow, locations[i].companyAddress, index);
                index++;
            }
        }

        if (mapProductAndServices) { // json productAndServices
            for (let i = 0; i < len; i++) {

                if(lastLocationItem >= len) { 
                    index_map = 0;
                }
                lastLocationItem++;

                latLng = new google.maps.LatLng(locations[i].provinceLocation.provinceLat, locations[i].provinceLocation.provinceLng);

                if ( locations[i].short_name == $('.setMapLocation.mapCountry option:selected').val() && locations[i].prouductAndServices == mapProductAndServices ) {
                    
                    showSingleMarker(latLng, locations[i].phone, locations[i].hrefPhone, locations[i].locationPage, locations[i].name, locations[i].pupUpinfoWindow, locations[i].companyAddress, index);
                    index++;
                }
            }
        }

        if (mapCompanyBrand) { // json companyBrand
            for (let i = 0; i < len; i++) {

                if(lastLocationItem >= len) {
                        index_map = 0;
                    }
                lastLocationItem++;

                latLng = new google.maps.LatLng(locations[i].provinceLocation.provinceLat, locations[i].provinceLocation.provinceLng);

                if ( locations[i].short_name == $('.setMapLocation.mapCountry option:selected').val() && locations[i].companyBrand == mapCompanyBrand ) {
                    showSingleMarker(latLng, locations[i].phone, locations[i].hrefPhone, locations[i].locationPage, locations[i].name, locations[i].pupUpinfoWindow, locations[i].companyAddress, index);
                    index++;
                }
                
            }
        }

        markersClusters = new MarkerClusterer(map, markers, {styles: clusterStyles});

        var markersLen = markers.length;
        if(markersLen){
            var bounds = new google.maps.LatLngBounds();
            for (var j=0; j<markersLen; j++) {
                bounds.extend(markers[j].getPosition());
            }
            map.fitBounds(bounds);

            zoomChangeBoundsListener = google.maps.event.addListener(map, 'bounds_changed', function(event) {
                
                if (this.getZoom() > 15) {
                    this.setZoom(13);
                }
                google.maps.event.removeListener(zoomChangeBoundsListener);
            });

        }
        else{
            if ( $('.setMapLocation.mapCountry').val() != 'All country' ) {
               mapPopup('No locations');
            } 

            map.fitBounds(defaultBounds);
        }
    };

    //show single
    var showSingleMarker = function(latLng, phone, hrefPhone, locationPage, name, pupUpinfoWindow, companyAddress, index){
        var marker = new google.maps.Marker({
            'position': latLng,
            'icon': {
                url: image
            },
            'index': index,
            'name': name,
            'phone': phone,
            'hrefPhone': hrefPhone,
            'locationPage': locationPage,
            'pupUpinfoWindow': pupUpinfoWindow,
            'companyAddress' : companyAddress
        });
        google.maps.event.addListener(marker, 'click', function(){
            showInfowindow(marker);
            scrollToMap();
        });
        markers.push(marker);
        marker.setMap(map);
        $('.locationCounter span').html(markers.length); // add currently number markers
    };

    //show infowindow
    var showInfowindow = function(marker){
        infoWindow.setContent(marker.pupUpinfoWindow);
        infoWindow.setPosition(marker.position);
        infoWindow.open();
    };

    //show closest
    var showTextEntries = function(bounds){
        textEntries = [];
        locationsHTMLtext = "";
        for (let i=0; i<markers.length; i++) {
            if (bounds && !bounds.contains(markers[i].position)) continue;
            textEntries.push(markers[i]);
        }
        textEntries.sort(function(a, b) {
            return google.maps.geometry.spherical.computeDistanceBetween(a.position, map.getCenter()) - google.maps.geometry.spherical.computeDistanceBetween(b.position, map.getCenter());
        });
        for (let i=0; i<textEntries.length; i++) {
            locationsHTMLtext += '<div class="location-text-entry" data-index="'+textEntries[i].index+'"><span>' + '<a href="' + textEntries[i].locationPage + '">' + textEntries[i].name + '</a>' + '</span>' + '<span> <a href="' + textEntries[i].hrefPhone + '">' + textEntries[i].phone + '</a>' + '</span>' + '</span>' + '<span>' + textEntries[i].companyAddress + '</span>' + '</div>';
        }
        if(locationsHTMLtext==='') locationsHTMLtext = "No search results";
        $('.map-locations-wrapper').html(locationsHTMLtext);
        $('.locationCounter span').html(textEntries.length); // add currently number markers
        $('.mobileStickynav .angleIconDown').removeClass('rotate');
    };

    //click location text
    $(document).on('click', '.location-text-entry', function(){
        var marker = markers[parseInt($(this).data('index'), 10)];
        map.setCenter(marker.position);
        map.setZoom(14);
        showInfowindow(marker);
    });

    //clear markers/clusters
    var clearLocations = function() {
        var markersLen = markers.length;
        for(var i=0;i<markersLen;i++){
            markers[i].setMap(null);
        }
        markers = [];
        if(markersClusters) markersClusters.clearMarkers();
    };

    //==================================================
    //================= Set Map Locations
    //==================================================
    $('.setMapLocation').on('change', function(){
        if(!selectChange) return false;
        
        scrollToMap();

        if ( $(this).hasClass('mapCountry') ) {
            mapCountry = $('.setMapLocation.mapCountry option:selected').val();
            checkSelectItems = 0;
        }
        if ( $(this).hasClass('province') ) mapProvince = $('.setMapLocation.province option:selected').val();
        if ( $(this).hasClass('companyBrand') ) mapCompanyBrand = $('.setMapLocation.companyBrand option:selected').val();
        if ( $(this).hasClass('productAndServices') ) mapProductAndServices = $('.setMapLocation.productAndServices option:selected').val();

        showProvinceMarkers($(this).val());
        clearAutocomplete();
    });

    //==================================================
    //================= CITY/POSTAL CODE
    //==================================================
    var locationAutocomplete = function(place){
        
        // -----  Reset Country, State/Province, Product/Service and Company/Brand select
        resetInputs();

        if(place.geometry) autocompleteLocation = place.geometry.location;
        $('#setradius')[0].sumo.enable();
        scrollToMap();

        //compare if autocomplete for province
        for(let i=0; i<provincesLen; i++){
            if(place.formatted_address.indexOf(provinces[i].text) !== -1){
                $('.setMapLocation')[0].sumo.selectItem(provinces[i].value);
                $('.setMapLocation')[0].sumo.reload();
                return false;
            }
        }

        //get province title from autocomplete
        if (place.address_components) {
            for (var i = 0; i < place.address_components.length; i++) {
                if (place.address_components[i].types[0] === "administrative_area_level_1") {
                    for(var j=0; j<provincesLen; j++){
                        if(provinces[j].text.indexOf(place.address_components[i].long_name) !== -1){
                            selectChange = false;
                            $('.setMapLocation')[0].sumo.selectItem(provinces[j].value);
                            $('.setMapLocation')[0].sumo.reload();
                            selectChange = true;
                            break;
                        }
                    }
                    break;
                }
            }
        }

        //search radius
        var availableLength = 0, radiusValue;
        for(var l=0; l<radiusesLen; l++){
            drawCircle(parseInt(radiuses[l].value, 10)*1000, autocompleteLocation);
            availableLength = showMarkers(circle.getBounds(), true);
            radiusValue = radiuses[l].value;
            if(availableLength) break;
        }
        if(!availableLength) mapPopup('No locations');
        map.fitBounds(circle.getBounds());
        selectChange = false;
        $('#setradius')[0].sumo.selectItem(radiusValue);
        $('#setradius')[0].sumo.reload();
        selectChange = true;
    };

    var clearAutocomplete = function(){
        $(input).val('');
        $('#setradius')[0].sumo.disable();
        clearSelect('#setradius');
        clearCircle();
    };

    //==================================================
    //================= RADIUS
    //==================================================
    $('#setradius').on('change', function(){
        if(!selectChange) return false;
        scrollToMap();
        drawCircle(parseInt($(this).val()*1000, 10), autocompleteLocation);
        map.fitBounds(circle.getBounds());
        showMarkers(circle.getBounds());
    });

    var drawCircle = function(radius, location) {
        clearCircle();
        circle = new google.maps.Circle({
            strokeColor: '#F2A900',
            strokeOpacity: 1,
            strokeWeight: 2,
            fillColor: '#ff0000',
            fillOpacity: 0,
            map: map,
            center: location,
            radius: radius
        });
    };

    var clearCircle = function() {
        if(circle) circle.setMap(null);
    };


    //==================================================
    //================= CUSTOM SELECT
    //==================================================
    $('#setradius')[0].sumo.disable();
    $('.setMapLocation.province')[0].sumo.disable();
    $('.setMapLocation.productAndServices')[0].sumo.disable();
    $('.setMapLocation.companyBrand')[0].sumo.disable();

    var selectChange = true;

    clearSelect = function(id){
        var resetValue = $(id).find('option:first').attr('value'),
            resetText = $(id).find('option:first').text(),
            sumoWrapper = $(id).parent();

        $(id)[0].sumo.selectItem(0);
        sumoWrapper.find('.selected').removeClass('selected');
        sumoWrapper.find('.CaptionCont > span').text(resetText);

        $(id).val(resetValue);
    };

    //==================================================
    //================= MAP POPUP
    //==================================================
    mapPopup = function(text){
        clearCircle();
        $('.map-popup').addClass('active').find('.map-popup-text').text(text);
    };

    $('.map-popup .buttonClose, .map-popup-close').on('click', function(){
        $('.map-popup').removeClass('active');
    });

    //==================================================
    //================= SCROLL TO MAP
    //==================================================

    function scrollToMap() {
        if ( $('.hamburger').is(':visible') ) {
            $('html,body').stop().animate( { scrollTop: $('.stickyWrapper').offset().top - ( $('header').outerHeight() + 25 - $('.stickyWrapper').outerHeight() ) }, 777 );
            $('.locationNav').slideUp(350);
            $('.mobileStickynav b').html($('.setMapLocation.mapCountry option:selected').html());
            $('.mobileStickynav .angleIconDown').removeClass('rotate');
        } else {
            $('html,body').stop().animate( { scrollTop: $('.stickyWrapper').offset().top - ( $('header').outerHeight() - $('.headerTopBar').outerHeight() ) }, 777 );
        }
    }

    //==================================================
    //================= ADD PROVINCE AND PRODUCT/SERVICES AND BRAND
    //==================================================
   
    var index_map = 0;
    function addProvince(fullName, shortName, prouductAndServices, companyBrand ) {
        
        if(index_map === 0) { //Clear select content only for one iteration and enable select
            $('.setMapLocation.province')[0].sumo.enable();
            $('.setMapLocation.productAndServices')[0].sumo.enable();
            $('.setMapLocation.companyBrand')[0].sumo.enable();

            $('.setMapLocation.province :first-child').nextAll().remove(); 
            $('.setMapLocation.productAndServices :first-child').nextAll().remove(); 
            $('.setMapLocation.companyBrand :first-child').nextAll().remove(); 
            
        }

        $('.setMapLocation.province')[0].sumo.add(shortName, fullName);
        $('.setMapLocation.productAndServices')[0].sumo.add(prouductAndServices, prouductAndServices);
        $('.setMapLocation.companyBrand')[0].sumo.add(companyBrand, companyBrand);
        
        checkSelectItems++;

        $('.setMapLocation.province')[0].sumo.reload();
        $('.setMapLocation.productAndServices')[0].sumo.reload();
        $('.setMapLocation.companyBrand')[0].sumo.reload();
        
        index_map++;

    }

    function resetInputs() {
            $('.setMapLocation.province :first-child').nextAll().remove(); 
            $('.setMapLocation.productAndServices :first-child').nextAll().remove(); 
            $('.setMapLocation.companyBrand :first-child').nextAll().remove(); 

            $('.setMapLocation.mapCountry')[0].sumo.selectItem(0);
            $('.setMapLocation.province')[0].sumo.reload();
            $('.setMapLocation.productAndServices')[0].sumo.reload();
            $('.setMapLocation.companyBrand')[0].sumo.reload();

            $('.setMapLocation.province')[0].sumo.disable();
            $('.setMapLocation.productAndServices')[0].sumo.disable();
            $('.setMapLocation.companyBrand')[0].sumo.disable();
        }

    $('.setMapLocation.mapCountry').on('change', function() {
        if ( $(this).val() == 'All country' ) {
            clearLocations();
            resetInputs();
            // -- Set new map zoom
            zoomChangeBoundsListener = google.maps.event.addListener(map, 'bounds_changed', function(event) {
                this.setZoom(2);
            
                google.maps.event.removeListener(zoomChangeBoundsListener);
        
            });
            // ---
            showMarkers();
        } 
    });

});